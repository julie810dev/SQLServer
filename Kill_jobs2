IF OBJECT_ID('tempdb..#tmpjobs') IS NOT NULL DROP TABLE #tmpjobs;
SELECT
    ja.job_id,
    j.name AS job_name
into #tmpjobs
FROM msdb.dbo.sysjobactivity ja
JOIN msdb.dbo.sysjobs j 
ON ja.job_id = j.job_id
WHERE ja.session_id = (SELECT TOP 1 session_id FROM msdb.dbo.syssessions ORDER BY agent_start_date DESC)
AND start_execution_date is not null
AND stop_execution_date is null
and datediff(HOUR, ja.start_execution_date,   getdate())>=1

declare @cont int = 1,
        @cant int = (select count(*) from #tmpjobs)
while @cont <= @cant begin
    declare @jobName nvarchar(max) = (select top (1) job_name from #tmpjobs order by job_id)
    exec msdb..sp_stop_job @jobName
    set @cont = @cont + 1
    delete from #tmpjobs where job_name = @jobName
end
IF OBJECT_ID('tempdb..#tmpjobs') IS NOT NULL DROP TABLE #tmpjobs;
